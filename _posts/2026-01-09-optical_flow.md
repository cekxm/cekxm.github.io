---
layout: post
title: "Optical Flow"
date: 2026-01-09 15:08:29 +0800
categories: []
description: RAFT, SEA-RAFT, Neuflow
tags: 
thumbnail: 
toc:
  sidebar: left
typora-root-url: ../
---

## RAFT

![image-20260108232610993](/images/2026-01-09-optical_flow/image-20260108232610993.png){: .img-fluid data-zoomable=""}

### 核心架构与组成部分

RAFT 主要由以下三个核心阶段组成：

- **特征提取（Feature Extraction）：**
  - 使用一个卷积特征编码器对两帧输入图像进行处理，提取每个像素的特征向量 。
  - 此外，还包含一个上下文编码器（Context Encoder），仅从第一帧图像中提取特征，用于后续迭代更新时的补充信息。
- **计算视觉相似度（Computing Visual Similarity）：**
  - **4D 相关体（4D Correlation Volumes）：** 通过计算两帧图像特征向量之间的内积，构建一个包含所有像素对相关性的 4D 体。
  - **相关性金字塔（Correlation Pyramid）：** 对 4D 相关体进行多尺度池化，生成一组不同分辨率的相关性卷。这种设计使模型能同时获取大位移和小位移的信息，且由于保留了高分辨率维度，能更好地捕捉小而快移动物体的运动。
- **迭代更新（Iterative Updates）：**
  - **GRU 单元：** 采用一个基于门控循环单元（GRU）的轻量级更新模块，它通过在相关性金字塔中执行“查表”操作来检索特征，并迭代地更新光流场。
  - 与之前常见的“由粗到精”（coarse-to-fine）设计不同，RAFT 始终在固定高分辨率下维护和更新单一的光流场。

在 RAFT（Recurrent All-Pairs Field Transforms）光流估计方法中，**不需要**像传统的“由粗到精”（coarse-to-fine）方法那样对图像或特征图进行显式的 Warp（重采样/扭曲）操作 。

## SEA-RAFT

![image-20260108233119443](/images/2026-01-09-optical_flow/image-20260108233119443.png){: .img-fluid data-zoomable=""}

SEA-RAFT 旨在通过对原始 RAFT 架构的优化，实现更简单（Simple）、更高效（Efficient）和更准确（Accurate）的光流估计 2。其核心改进包括引入了新的损失函数、直接回归初始光流、刚体运动预训练以及架构简化。

### 核心改进与技术特点

- **混合拉普拉斯损失（Mixture of Laplace Loss）：**
  - SEA-RAFT 摒弃了标准 RAFT 使用的 $$L_1$$ 损失，转而训练网络预测混合拉普拉斯分布的参数。
  - 该设计允许模型量化预测的不确定性，特别是在重度遮挡导致的歧义情况下，通过不同的混合分量来应对，从而显著减少过拟合并提升泛化能力。
- **直接回归初始光流（Directly Regressed Initial Flow）：**
  - 原始 RAFT 将光流初始化为零，这往往偏离真实值较远，需要大量迭代才能收敛。
  - SEA-RAFT 通过复用现有的上下文编码器（Context Encoder），直接根据输入的双帧图像预测一个初始光流估计。
  - 这一简单的改变以极低的额外开销大幅减少了所需的迭代次数，提升了效率。
- **大尺度刚体运动预训练（Rigid-Flow Pre-Training）：**
  - 模型首先在 TartanAir 数据集上进行预训练。虽然该数据集仅包含由相机运动产生的静态场景位移（刚体运动），但其高度的真实感和场景多样性显著增强了模型的跨数据集泛化能力。
- **架构简化（Architectural Simplifications）：**
  - **标准化主干：** 将 RAFT 原有的定制化编码器替换为标准的 ResNet 模型，使得训练更加稳定。
  - 高效 RNN：** 将原始的卷积 GRU 替换为由 ConvNext 模块组成的简单 RNN，这使得模型更容易集成新的神经构建块，且更易于扩展到大规模数据集。

## FlowSeek

M. Poggi and F. Tosi, "FlowSeek: Optical Flow Made Easier with Depth Foundation Models and Motion Bases," in Proc. IEEE/CVF Int. Conf. Comput. Vis. (ICCV), Oct. 2025, pp. 5667-5679.

![image-20260109130959464](/images/2026-01-09-optical_flow/image-20260109130959464.png){: .img-fluid data-zoomable=""}

FlowSeek 是一种在 2025 年 ICCV 上提出的新型光流估计方法，其核心理念是通过引入**深度基础模型（Depth Foundation Models）**和**经典运动基底（Motion Bases）**来简化光流任务的训练并提升其泛化能力。



以下是 FlowSeek 方法的详细介绍：

### 1. 核心设计理念：融合三大领域

FlowSeek 的架构设计处于以下三个领域的交汇点：

- **先进光流架构：** 以 **SEA-RAFT** 作为骨干网络（Backbone），继承了其混合拉普拉斯损失和高效的迭代更新机制。
- **深度基础模型 (VFMs)：** 集成了如 **Depth Anything v2** 等在大规模数据集上预训练的模型，利用其丰富的几何和语义先验信息。
- **经典运动参数化：** 引入了 30 年前经典的低维运动基底理论，将相机运动诱导的光流简化为 6 个自由度的线性组合。

### 2. 详细架构组成

FlowSeek 在 SEA-RAFT 的基础上增加了以下关键模块：

- **特征增强：** 利用深度基础模型的解码器特征 $$\Phi$$ 增强原始的卷积特征 $$F$$，从而构建更具几何感知力的 4D 相关体。
- **BasesNet（基底网络）：** 核心创新模块。它根据预测的逆深度图 $$D_0$$ 计算出 8 个运动基底矢量（包括平移和旋转分量），并提取运动特征 $$H_B$$。
- **上下文增强：** 将预测的深度图与原始图像一同输入 ContextNet，以提取更强的上下文特征 $$C$$ 和初始隐藏状态 $$H^0$$ 。
- **迭代更新：** 改进后的 UpdNet 在迭代过程中同时参考相关性查找结果、隐藏状态以及来自运动基底的特征。

### 3. 主要优势与改进点

- **极低的硬件成本：** FlowSeek 仅需 **单张消费级 GPU（如 RTX 3090）** 即可完成训练，相比于 SEA-RAFT 等方法所需的 8 张 GPU，硬件预算降低了约 8 倍。
- **卓越的泛化能力：** 通过利用深度先验，FlowSeek 在未见过的场景（如 Sintel 和 KITTI）中表现出极强的 Zero-shot 泛化性能，比 SEA-RAFT 提升了 10% 到 15%。
- **更细腻的细节表现：** 深度基础模型的引入使得光流预测在物体边缘和精细结构上更加准确，解决了传统模型在跨域测试时细节缺失的问题。

| **特性**              | **SEA-RAFT**             | **FlowSeek**                   |
| --------------------- | ------------------------ | ------------------------------ |
| **先验知识**          | 仅依赖图像特征           | 图像特征 + 深度图 + 运动基底   |
| **硬件需求**          | 通常需要 8x 3090 GPU     | **1x 3090 GPU**                |
| **性能 (Spring EPE)** | ~4.79 (S版)              | **~3.31 (L版)**                |
| **关键改进**          | 混合损失、直接回归初始流 | **基础模型特征融合、BasesNet** |
| **复杂度**            | 较低                     | 较高（需运行额外的深度模型）   |

## NeuFlow-v2

Z. Zhang, A. Gupta, H. Jiang, and H. Singh, "NeuFlow v2: Push High-Efficiency Optical Flow To the Limit," in 2024 IEEE/RSJ Int. Conf. Intell. Robots Syst. (IROS), 2024, doi: 10.1109/IROS58592.2024.10802353.

![image-20260109130930368](/images/2026-01-09-optical_flow/image-20260109130930368.png){: .img-fluid data-zoomable=""}

**NeuFlow-V2**（全称：NeuFlow v2: Push High-Efficiency Optical Flow To the Limit）是 2024 年提出的一款专为**边缘设备和实时机器人应用**设计的高效光流估计算法。

它在 NeuFlow-V1 的基础上进行了深度优化，核心目标是：在保持与 SOTA（当前最佳）方法相当精度的同时，极大地降低计算开销。

### 1. 核心技术创新点

- **极简骨干网络 (Simple Backbone)：**
  - 与传统方法（如 RAFT 使用较重的卷积网络）不同，NeuFlow-V2 认为光流任务更依赖**低级特征**而非高级语义。
  - 它直接从不同尺度的图像金字塔（1/2, 1/4, 1/8）中提取特征，每个卷积块仅包含两层卷积。这种设计大幅减少了计算量，同时保留了更多的纹理细节。
- **全局匹配与交叉注意力 (Cross-Attention & Global Matching)：**
  - 为了处理大位移运动，它在 1/16 低分辨率尺度上引入了 **Cross-Attention**。
  - 这增强了图像间特征的判别性，通过全局匹配计算出一个初始光流，为后续迭代提供一个良好的起点。
- **轻量级 RNN 迭代模块：**
  - **抛弃 GRU/LSTM：** 原始 RAFT 使用的 GRU 单元计算相对复杂。NeuFlow-V2 使用基于简单卷积层的 RNN 结构来整合隐藏状态、当前光流和 Warp 后的相关性特征。
  - **数值稳定性：** 引入了 `HardTanh` 函数来约束隐藏状态的范围，解决了简单 RNN 容易出现的梯度消失或爆炸问题。
- **多尺度特征融合：**
  - 通过将 1/16 尺度的全局上下文信息与 1/8 尺度的局部细节特征进行融合，弥补了轻量级骨干网络感受野较小的缺点。

### 2. 性能表现 (效率王者)

NeuFlow-V2 的最大亮点在于其极致的运行效率，这使它成为目前在嵌入式硬件上表现最好的模型之一：

| **特性**     | **表现说明**                                                 |
| ------------ | ------------------------------------------------------------ |
| **推理速度** | 在 **NVIDIA Jetson Orin Nano** 上可达到 **20+ FPS** (512x384 分辨率)。 |
| **加速比**   | 相比于 RAFT 或 GMFlow 等主流方法，实现了 **10x - 70x** 的加速。 |
| **精度水平** | 在 Sintel 和 KITTI 基准测试中，精度接近 SEA-RAFT 等 SOTA 模型，但计算成本极低。 |
| **跨域泛化** | 尽管模型轻量，但其设计确保了在真实世界场景（非训练集）中依然保持稳健的预测效果。 |

### 3. 与 RAFT / SEA-RAFT 的区别

| **维度**     | **RAFT / SEA-RAFT**           | **NeuFlow-V2**                      |
| ------------ | ----------------------------- | ----------------------------------- |
| **主要目标** | 追求最高精度（科研/离线处理） | **追求极致实时性（边缘端/机器人）** |
| **迭代核心** | 复杂的 ConvGRU 单元           | 简单的 CNN-based RNN                |
| **匹配方式** | 4D 相关体 + 局部查找          | 全局匹配 (1/16) + 局部细化          |
| **应用场景** | 服务器端视频处理              | **无人机导航、移动机器人 SLAM**     |

## 对比

FlowSeek 和 NeuFlow-V2 代表了光流估计领域的两个极端：**FlowSeek 追求极致的泛化精度与细节还原**（利用基础模型先验），而 **NeuFlow-V2 追求极致的计算效率与嵌入式部署性能**。

以下是两者的详细对比分析：

------

### 1. EPE 误差（精度与泛化能力）

**结论：FlowSeek 在绝对精度和零样本（Zero-shot）泛化能力上显著领先。**

- **FlowSeek (高精度标杆)：**
  - **核心优势：** 它引入了“深度基础模型”（如 Depth Anything v2），使模型具备了强大的空间几何感知能力。
  - **性能表现：** 在 Sintel Final 和 KITTI 数据集上，其精度比之前的 SOTA 模型 SEA-RAFT 提升了约 **10%-15%**。在 Spring 这种复杂数据集上，其 EPE 表现极其出色（L 版本可达到约 **3.31**）。
  - **细节还原：** 能够精确捕捉物体边缘，解决了很多模型在处理细小物体或快速运动时的模糊问题。
- **NeuFlow-V2 (高效率平衡)：**
  - **核心优势：** 在极低功耗下维持了“可接受”的高精度。
  - **性能表现：** 其精度接近但略逊于 SEA-RAFT 和 RAFT。在 Sintel 数据集上的 EPE 通常在 **2.0-3.0** 左右（取决于具体测试子集和训练阶段）。
  - **局限性：** 为了换取速度，它使用了极简的骨干网络，在处理极复杂场景（如重度遮挡或光照剧烈变化）时，精度上限不如 FlowSeek。

------

### 2. 计算量与效率（计算开销）

**结论：NeuFlow-V2 在推理速度和轻量化方面具有压倒性优势；FlowSeek 在训练成本上表现优异。**

- **NeuFlow-V2 (端侧王者)：**
  - **推理速度：** 专为边缘计算设计。在 **Jetson Orin Nano** 上能跑到 **20+ FPS**，而同类高精度模型通常只有 1-2 FPS 甚至更低。
  - **架构极简：** 使用简单的 CNN-RNN 替代了复杂的 GRU，去除了冗余的特征提取层，计算量（FLOPs）远低于其他模型。
  - **部署友好：** 它是目前机器人和无人机领域实时光流估计的首选。
- **FlowSeek (训练高效，推理较重)：**
  - **训练成本：** 最大的卖点之一是**单卡可训**。传统 SOTA 模型往往需要 8 张 A100/H100，而 FlowSeek 仅需一张 RTX 3090 即可完成训练。
  - **推理开销：** 尽管在光流分支上进行了优化，但由于其依赖于外部的“深度基础模型”提供先验特征，推理时需要同时运行深度模型和光流模型，总体的计算延迟明显高于 NeuFlow-V2。

------

### 3. 综合对比总结

| **维度**       | **FlowSeek**                           | **NeuFlow-V2**                      |
| -------------- | -------------------------------------- | ----------------------------------- |
| **主要定位**   | 追求最高泛化精度（科研、离线分析）     | 追求极致实时性（机器人、端侧部署）  |
| **EPE 表现**   | **极佳 (SOTA 级别)**                   | 优秀 (接近 SOTA，但略有妥协)        |
| **硬件需求**   | 单张 3090 可训，推理需较强 GPU         | **Jetson 等嵌入式设备即可流畅运行** |
| **核心创新点** | 深度基础模型 + 运动基底 (Motion Bases) | 极简骨干网络 + 轻量 RNN + 全局匹配  |
| **适用场景**   | 高精度视频合成、运动捕捉、电影特效     | **无人机避障、SLAM、增强现实 (AR)** |

