---
layout: post
title: "Repvgg"
date: 2024-12-30 00:17:23 +0800
categories: []
description: 简要介绍
tags: 
thumbnail: 
toc:
  sidebar: left
typora-root-url: ../
---

## 图解RepVGG]([图解RepVGG (qq.com)](https://mp.weixin.qq.com/s/OIpRRBnxaW1opTmlmwuEpw))

1. 基于多分支结构设计，如残差网络add，Inception系列中的concat操作。多分支结构带来的问题是难以自定义，增加推理时间，增加显存消耗（因为需要保存各个分支的结果，直到add操作后，显存才会减少，后续会分析）
2. 一些网络结构组件，比如为轻量化网络设计的DepthwiseConv和ShuffleNet中的channel shuffle。这些操作会提高访存消耗，FLOPS看起来很低，但并不能反应实际推理速度。
3. 多分支结构会引入网络结构的约束，**比如Resnet的残差结构要求输入和卷积出来的张量维度要一致（这样才能相加）**，这种约束导致网络不易延伸拓展，也一定程度限制了通道剪枝。对应的单路结构就比较友好，剪枝后也能得到很好的加速比。

$$
Out=F(x)+G(x)+X
$$

![图片](/images/2024-12-30-RepVGG/640.webp){: .img-fluid}

## 推理中的融合

### 卷积和BN融合

<img class="img-fluid" src="/images/2024-12-30-RepVGG/image-20210906172600280.png" alt="image-20210906172600280" style="zoom:80%;" />

### 3x3卷积和1x1卷积融合

![图片](/images/2024-12-30-RepVGG/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1){: .img-fluid}

### identity分支等效特殊权重卷积层

注意，identity 不等同于 1x1conv。它是 depthwise的。

注意在 multi-branch 中，输入和输出的channel数是一样的。identity 相当于 C 个 $$C\times 1 \times 1$$的卷积。

![641](/images/2024-12-30-RepVGG/641.webp){: .img-fluid}



上面三个1x1，按扫描顺序可以排成一个单位阵。

![img](/images/2024-12-30-RepVGG/640.webp){: .img-fluid}